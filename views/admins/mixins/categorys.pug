mixin categoryRows(categories, depth = 0)
  each item in categories
    - __row = __row + 1
    - const idStr  = item?._id != null ? String(item._id) : null
    - const pidStr = item?.parentId != null ? String(item.parentId) : null
    - __rowMap[idStr] = __row                     // lưu STT của node hiện tại
    - const parentIdx = pidStr && __rowMap[pidStr] ? __rowMap[pidStr] : '—'  // STT cha

    tr(data-id=item._id data-parent=item.parentId)
      td
        input(type="checkbox", name="id", value=item._id, checkItem)
      td #{__row}                                  
      td
        .fw-semibold(style=`padding-left:${depth * 16}px`) #{item.name}
        if item.description
          .text #{item.description}
      td /#{item.slug}
      td #{parentIdx}                              
      td
        input.form-control.form-control-sm(type="number", name="position", style="width:80px", value=item.position)
      td
        - const isActive = item.status === 'active'
        span.badge(
          class=isActive ? "bg-success" : "bg-danger",
          role="button",
          data-id=item._id,
          data-status=item.status,
          change-status
        ) #{isActive ? "Hoạt động" : "Dừng hoạt động"}
      td
        .k-actions.d-flex.flex-wrap
          button.btn.btn-outline-secondary.btn-sm(data-id=item._id edit-category)
            i.fas.fa-pen.me-1
            | Sửa
          button.btn.btn-outline-danger.btn-sm.ms-2(data-id=item._id delete-category)
            i.fas.fa-trash.me-1
            | Xóa

    // con render ngay sau cha (map đã có STT cha)
    if item.children && item.children.length
      +categoryRows(item.children, depth + 1)
