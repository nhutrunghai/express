//- views/clients/product/detail.pug
extends ../../layout/default.pug
include ../../mixins/product.mixin.pug

block main
  // style.
  //   body{background:#f3f4f6;} /* xÃ¡m nháº¡t náº¿u muá»‘n Ã¡p riÃªng trang */

  style.
    /* khá»‘i ná»™i dung sÃ¡ng ná»•i báº­t */
    .page-section{background:#fff;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,.06)}
    .ratio-1x1{position:relative;padding-top:100%}
    .ratio-1x1>img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:.25rem}
    .thumbs img{width:60px;height:60px;object-fit:cover}
    .text-price{color:#e11d48;font-weight:700;font-size:1.75rem}
    /* REVIEW */
    .rv-item{padding:16px 0;border-top:1px solid #f0f2f5}
    .rv-left{width:60px}
    .avatar{width:40px;height:40px;border-radius:50%;background:#e8eef6;color:#5b6b88;display:flex;align-items:center;justify-content:center;font-weight:700}
    .stars{color:#f59e0b;font-size:1.05rem}
    .rv-badge{color:#16a34a;background:#e7f7ec;border-radius:6px;padding:2px 6px;font-size:.8rem;margin-left:8px}
    .rv-meta{font-size:.85rem;color:#6b7280}
    .rv-actions a{color:#6b7280;font-size:.9rem;margin-right:14px;text-decoration:none}
    .rv-actions a:hover{text-decoration:underline;color:#374151}
    /* Sáº£n pháº©m tÆ°Æ¡ng tá»±: card gá»n, nhiá»u item 1 hÃ ng */
    .product-card .card-title{font-size:.95rem;margin-bottom:.25rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .product-card .price{font-weight:700;color:#e11d48}
    .product-card .badge{font-size:.7rem}
    /* Buttons: style giá»‘ng yÃªu cáº§u */
    .btn-buy{background:#ff5252;border-color:#ff5252;color:#fff;font-weight:600;border-radius:6px;padding:.75rem 1rem}
    .btn-buy:hover{background:#ff3b3b;border-color:#ff3b3b;color:#fff}
    .btn-cart{border-width:2px;font-weight:600;border-radius:6px;padding:.75rem 1rem}

  //- KHá»I Ná»˜I DUNG CHÃNH (sÃ¡ng) -----------------------------

  .container.py-3.page-section.mt-3
    .row
      // ========== LEFT: GALLERY ==========
      .col-lg-4.mb-3
        .card.shadow-sm
          .card-body
            .ratio-1x1.mb-3
              img(src=product.thumbnail alt="áº¢nh sáº£n pháº©m")
            .d-flex.thumbs
              img.img-thumbnail.mr-2(src="https://images.unsplash.com/photo-1512820790803-83ca734da794?w=140&h=140&fit=crop" alt="thumb")
              img.img-thumbnail.mr-2(src="https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?w=140&h=140&fit=crop" alt="thumb")
              img.img-thumbnail(src="https://images.unsplash.com/photo-1519681393784-d120267933ba?w=140&h=140&fit=crop" alt="thumb")

      // ========== CENTER: INFO ==========
      .col-lg-5.mb-3
        .card.shadow-sm.mb-3
          .card-body
            .mb-2
              span.badge.badge-warning.mr-2.text-primary 30 NGÃ€Y Äá»”I TRáº¢
              span.badge.badge-primary.text-primary CHÃNH HÃƒNG
              span.text-muted.small.ml-2 TÃ¡c giáº£: ..., ..., ...
            h3.mb-2 #{product.title}
            .d-flex.align-items-center.mb-2
              span.mr-2.stars â˜…â˜…â˜…â˜…â˜…
              span.small.text-muted (33) Â· ÄÃ£ bÃ¡n 285
            .mb-1.text-price #{product.newPrice ? `${product.newPrice}Ä‘` : `${product.price}Ä‘`}
            if product.newPrice
              .small.text-muted
                | GiÃ¡ sau Ã¡p dá»¥ng mÃ£ khuyáº¿n mÃ£i Â· 
                del.mr-1 #{product.price}Ä‘
            hr
            h5.mb-3 ThÃ´ng tin váº­n chuyá»ƒn
            .d-flex.justify-content-between.align-items-center.mb-2
              span.small.text-muted Giao Ä‘áº¿n Q. HoÃ n Kiáº¿m, P. HÃ ng Trá»‘ng, HÃ  Ná»™i
              a.small(href="#") Äá»•i
            ul.list-unstyled.mb-0
              li.mb-2 Giao Ä‘Ãºng chiá»u Thá»© Ba Â· 
                span.text-success Miá»…n phÃ­
              li Freeship 10k Ä‘Æ¡n tá»« 45k, Freeship 25k Ä‘Æ¡n tá»« 100k

      // ========== RIGHT: CARD MUA HÃ€NG ==========
      .col-lg-3.mb-3
        .card.shadow-sm
          .card-body
            .d-flex.align-items-center.mb-2
              img.rounded(src="https://via.placeholder.com/36" width="36" height="36")
              .ml-2.flex-grow-1
                strong PhÆ°Æ¡ng ÄÃ´ng Books
                .small.text-muted 4.8 â˜… (38k+ Ä‘Ã¡nh giÃ¡)
              button.btn.btn-sm.btn-light(type="button") ðŸ”
            label.d-block.font-weight-bold.mt-2.mb-1 Sá»‘ LÆ°á»£ng
            .input-group.input-group-sm.mb-3(style="width:160px")
              .input-group-prepend
                button#qtyMinus.btn.btn-outline-secondary(type="button") âˆ’
              input#qtyInput.form-control.text-center.stockInput(type="number" min="1" max=product.stock  value="1")
              .input-group-append
                button#qtyPlus.btn.btn-outline-secondary(type="button") +
            .text-muted.mb-1 Táº¡m tÃ­nh
            h4.font-weight-bold.mb-3.price-total #{product.newPrice ? `${product.newPrice}Ä‘` : `${product.price}Ä‘`}
            // ======= 2 NÃšT, Má»–I NÃšT 1 HÃ€NG (Ã©p block tuyá»‡t Ä‘á»‘i) =======
            button.btn.btn-buy.d-block.w-100.mb-2(type="button") Mua ngay
            button.btn.btn-outline-primary.btn-cart.d-block.w-100(type="button") ThÃªm vÃ o giá»
            form.add-data(action="" method="POST" hidden)
              input(type="text" name='product_id' value=product._id)
              input(type="number" name='stock') 
  // ========== (1) MÃ” Táº¢ Sáº¢N PHáº¨M ==========
  .container.page-section.mb-3
    .card.border-0
      .card-body
        h5.mb-3 MÃ´ táº£ sáº£n pháº©m
        p !{product.description}

  // ========== (2) ÄÃNH GIÃ (chá»‰ hiá»ƒn thá»‹) ==========
  .container.page-section.mb-3
    .card.border-0
      .card-body
        h5.mb-3 ÄÃ¡nh giÃ¡ & bÃ¬nh luáº­n

        .rv-item.d-flex.align-items-start
          .rv-left.mr-3
            .avatar HN
          .flex-grow-1
            .d-flex.justify-content-between
              .mb-1
                strong.mr-2 Nguyá»…n HoÃ i Nga
                span.stars â˜…â˜…â˜…â˜…â˜…
                span.rv-badge ÄÃ£ mua hÃ ng
                span.ml-2.font-weight-bold Cá»±c kÃ¬ hÃ i lÃ²ng
              a.rv-share.text-muted(href="#") Chia sáº» â†—
            .rv-meta.mb-1 ÄÃ£ tham gia 8 nÄƒm Â· ÄÃ£ viáº¿t 177 Ä‘Ã¡nh giÃ¡ Â· ÄÃ£ nháº­n 0 lÆ°á»£t cáº£m Æ¡n
            .rv-meta.mb-2 ÄÃ¡nh giÃ¡ vÃ o 7 thÃ¡ng trÆ°á»›c Â· ÄÃ£ dÃ¹ng 1 thÃ¡ng
            .rv-actions.mt-1
              a(href="#") ðŸ‘ Há»¯u Ã­ch
              a(href="#") ðŸ’¬ BÃ¬nh luáº­n
              a(href="#") â†— Chia sáº»

        .rv-item.d-flex.align-items-start
          .rv-left.mr-3
            .avatar LT
          .flex-grow-1
            .d-flex.justify-content-between
              .mb-1
                strong.mr-2 LÃª Trang
                span.stars â˜…â˜…â˜…â˜…â˜…
                span.rv-badge ÄÃ£ mua hÃ ng
                span.ml-2.font-weight-bold Cá»±c kÃ¬ hÃ i lÃ²ng
              a.rv-share.text-muted(href="#") Chia sáº» â†—
            .rv-meta.mb-1 ÄÃ£ tham gia 4 nÄƒm Â· ÄÃ£ viáº¿t 5 Ä‘Ã¡nh giÃ¡ Â· ÄÃ£ nháº­n 0 lÆ°á»£t cáº£m Æ¡n
            .rv-meta.mb-2 ÄÃ¡nh giÃ¡ vÃ o 7 thÃ¡ng trÆ°á»›c Â· ÄÃ£ dÃ¹ng 4 ngÃ y
            .rv-actions.mt-1
              a(href="#") ðŸ‘ Há»¯u Ã­ch
              a(href="#") ðŸ’¬ BÃ¬nh luáº­n
              a(href="#") â†— Chia sáº»

        .rv-item.d-flex.align-items-start
          .rv-left.mr-3
            .avatar NT
          .flex-grow-1
            .d-flex.justify-content-between
              .mb-1
                strong.mr-2 Nguyá»…n TuyÃªn
                span.stars â˜…â˜…â˜…â˜…â˜…
                span.rv-badge ÄÃ£ mua hÃ ng
                span.ml-2.font-weight-bold Cá»±c kÃ¬ hÃ i lÃ²ng
              a.rv-share.text-muted(href="#") Chia sáº» â†—
            .rv-meta.mb-2 ÄÃ£ tham gia 4 nÄƒm Â· ÄÃ£ viáº¿t 6 Ä‘Ã¡nh giÃ¡ Â· ÄÃ£ nháº­n 0 lÆ°á»£t cáº£m Æ¡n
            p.mb-2 Ná»™i dung bá»• Ã­ch, hÃ¬nh áº£nh Ä‘áº¹p
            img.rounded(src="https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?w=400&h=260&fit=crop" alt="áº£nh review")
            .rv-meta.mt-2 ÄÃ¡nh giÃ¡ vÃ o 3 nÄƒm trÆ°á»›c Â· ÄÃ£ dÃ¹ng 3 ngÃ y
            .rv-actions.mt-1
              a(href="#") ðŸ‘ Há»¯u Ã­ch
              a(href="#") ðŸ’¬ BÃ¬nh luáº­n
              a(href="#") â†— Chia sáº»

  // ========== (3) Sáº¢N PHáº¨M TÆ¯Æ NG Tá»° ==========
  .container.page-section.mb-4
    h5.mb-3 Sáº£n pháº©m tÆ°Æ¡ng tá»±
    .row
      each n in [1,2,3,4,5,6,7,8,9,10,11,12]
        .col-6.col-sm-4.col-md-3.col-lg-2.mb-3
          .card.h-100.product-card.shadow-sm
            a(href="#")
              img.card-img-top(src=`https://picsum.photos/seed/book${n}/400/400` alt="product")
            .card-body.p-2
              h6.card-title.mb-1 TÃªn sáº£n pháº©m gá»£i Ã½ #{n}
              .small.text-muted NhÃ  bÃ¡n A Â· â˜…â˜…â˜…â˜…â˜†
              .price.mt-1 199.000Ä‘
block scripts  
  script.
    (function () {
      const minus = document.getElementById('qtyMinus');
      const plus  = document.getElementById('qtyPlus');
      const input = document.getElementById('qtyInput');
      const priceInput = document.getElementsByClassName('price-total')[0]
      const price = parseFloat(priceInput.innerText.split('Ä‘')[0]||1)
      const btnCart = document.querySelector('.btn-cart')
      const formAdd = document.querySelector('.add-data')
      const stockInput = document.querySelector('.stockInput')
      btnCart.addEventListener("click",() => { 
        formAdd.action = "/cart/add"
        formAdd.querySelector('input[name="stock"]').value = stockInput.value
        formAdd.submit()
      })
      if (!minus || !plus || !input) return;
      minus.addEventListener('click', function(){ const v = parseInt(input.value||1,10); if (v>1) {
        input.value = v-1 
        const result = input.value * price
        priceInput.innerText = `${result}Ä‘`
        } });
      plus.addEventListener('click',  function(){ const v = parseInt(input.value||1,10); if(!(v + 1 > input.max)) {
        input.value = v+1;
        const result = input.value * price
        priceInput.innerText = `${result}Ä‘`
      } });
    })();

